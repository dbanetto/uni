\documentclass{CRPITStyle}
\usepackage[authoryear]{natbib}
\renewcommand{\cite}{\citep}
\pagestyle{empty}
\thispagestyle{empty}
\hyphenation{roddick}

\begin{document}

\title{When to use NoSQL}
\author{David Barnett}
\affiliation{School of Engineering and Computer Science \\
Victoria University of Wellington, \\
PO Box 600, Wellington, 6140 \\
Email:~{\tt barentdavi@myvuw.ac.nz}}

\maketitle

\begin{abstract}
    TODO Abstract
\end{abstract}

\vspace{.1in}

\noindent{\em Keywords:} NoSQL, Use cases, Document Store, Columnar, Graph database

\section{Introduction}
% Cover the aim of the essay

\paragraph{}
With growing use of NoSQL databases in production environments it has become more
important to understand when and why to use them over a traditional
relational database.
NoSQL can be broken down to many different types which differ on how
data is represented~\cite{type_nosql}.
For example the traditional relational databases are based upon relational
model and relational algebra~\cite{relational_db}.

\paragraph{}
This report will cover some common types of NoSQL databases.
These are: Document store; Columnar; and, Graph databases.
For each of these types this report will give an overview on how each type
operates and a description of its use case with a comparison with a
 relational database.

\section{What is NoSQL}
% brief overview

\paragraph{}
NoSQL is a class of databases that are not based on
a relational data model~\cite{nosql_db,nosql_survey}.
Instead of using relations the data is modeled using a large
variety of models are used, such as graphs, documents or objects.
These allow for application specific optimisations that
a relational database could not provide.
The need for these optimisations are motivated by the growing
volume of data used in large distributed systems~\cite{nosql_db,nosql_survey}.


\paragraph{}
The CAP theorem states that no distributed system can be
simultaneously always consistent, available and
partitions tolerant but at most two of these properties~\cite{base,nosql_db,compare_nosql,nosql_survey}.
This is due to the conflict between these properties, such as a
strictly consistent database handling an update would
need to lock the modified data as the update is being distributed
so all clients have the same consistent data.

\paragraph{}
In the case of databases they can be designed to provide a
range of guarantees and to how the data is stored and retrieved.
For relational databases they are designed to hold
the ACID properties~\cite{relational_db,base}.
Figure~\ref{l:acid} provides a brief outline of the ACID properties.
These properties ensure that the data committed will be stored in a 
consistent manner that allows some concurrency.
This is highly desired in applications that require guaranteed consistency
for critical data such as bank accounts.
In terms of the CAP theorem the consistency aspect is the most important
guarantee.

\begin{figure}
\begin{itemize}
    \item \textbf{A}tomic - every transaction will either
        succeed and be applied or fail and commit no modifications.
    \item \textbf{C}onsistent - the state of all relations are
        always in a consistent state.
    \item \textbf{I}solation - transactions are performed as if sequentially.
    \item \textbf{D}urability - after a successful transaction the results
        are persistent over crashes.
\end{itemize}
    \caption{Outline of the ACID properties~\cite{relational_db,base}}\label{l:acid}
\end{figure}
%
% give definition of a database? (managed store of data)
% relational is based on set theory and relational algebra

%% BASE
% What it is

\paragraph{}
An alternative to ACID is BASE where the objective is replaced from consistency
to availability~\cite{nosql_survey}.
This is desirable in large distributed systems that do not need to be
fully consistent but require to always be available.
For example an application will not mind that it has some stale or
inconsistent data since it has been built to handle it.
This is generally present in NoSQL databases when used in multiple
locations, such as a distributed document store~\cite{base}.
Figure~\ref{l:base} has a brief outline of these properties.

\begin{figure}
\begin{itemize}
    \item \textbf{B}asically \textbf{A}vailable - When a part of the system
        fails only some or none of the data maybe be unavailable rather than
        all of it.
    \item \textbf{S}oft state - The data present on a node may change over time
        without a direct update as eventual consistency is applied.
    \item \textbf{E}ventual consistency - The shared data on a node will become consistent with
        other nodes over time.
\end{itemize}
\caption{Overview of BASE properties~\cite{base}}\label{l:base}
\end{figure}

% How does it compare to ACID

% how it relates to NoSQL

% trade-off between consistency, availability and partition tolerant

% === Document Store ===

\section{Document Store}
% How does it work
%  - key to a structured document
%  - document can be inspected by DBMS
% Relate it back to BASE

\paragraph{}
Document store databases are designed to store their data in the form of
structured documents~\cite{base,nosql_survey}.
There are a wide range of structured documents used with document store
databases, such as XML, JSON and more~\cite{base,compare_nosql}.
Two implementations of a document store database are: \textbf{MongoDB} which
structures its data as JSON~\cite{base}; and, \textbf{BaseX} which is based on XML
documents~\cite{basex}.
Though the format of the documents are well defined the 
way how data is laid out within this format is not.
This makes documents stores a semi-structured database.

\paragraph{}
The data model for a document store can be simpler relative a relational
model~\cite{nosql_survey}.
A single document is an instance of an entity, such as someone's contact information.
Where in a relational model someone's contact information would be
normalized to be spread over many tables as there are many optional
sections.
In this case the document representation is simpler as it has all of the
information in one place.
This lead to the pattern of storing all the data for a single entity into
one document rather than spread it over many relations that then need to
joined.

\paragraph{}
A benefit of a document store is being able to query the documents
by leveraging their structure.
This is exposed to the user through the database's API or a format specific
query language, such as XPath for XML~\cite{xpath}.
For example in MongoDB the call in figure~\ref{lst:mongo} would retrieve all
stored documents about books with the title \textit{Database}.
In this case MongoDB's API is designed to mimic the internal JSON structure 
of the stored documents.
Another example is BaseX with its ability to use XPath to query a document.
In figure~\ref{lst:basex} shows a simple XPath query that also retrieves
the documents that contain books with the title \textit{Database}.

\begin{figure}
\begin{verbatim}
books.find({ title: "Database" })
\end{verbatim}
\caption{Example query for MongoDB}
\label{lst:mongo}
\end{figure}

\begin{figure}
\begin{verbatim}
/book/tite[text() = 'Database']
\end{verbatim}
\caption{Example query for BaseX using XPath}
\label{lst:basex}
\end{figure}

\subsection{Use case}
% When are people using this
%  - JSON store
%  - XML store
% Example of use case
%  - Searching

\cite{nosql_performance}
% should include what people use it for and why they choose it

% === Columnar ===

\section{Columnar}
% How does it work
% Relate it back to BASE

\paragraph{}
Columnar or column-orientated databases are a type of NoSQL databases that
stores data in tables by column rather than by row~\cite{nosql_survey}.
The goal of a columnar database is to store large quantities of data efficiently
while maintaining efficient operations on columns~\cite{nosql_survey,nosql_eval}.
Implementations of a columnar database are Google's
\textbf{BigTable}, which is used for large scale~\cite{bigtable}, and
\textbf{Cassandra}, ~\cite{cassandra}.

% data model
\paragraph{}
The data model of columnar databases is a multi-dimensional
map~\cite{bigtable,nosql_eval}.
Each instance of an entity is a row in a table.
With each row it is given a row name, this is used to uniquely identify the
given row.
Each row has a set of columns that describe the entity
The columns maybe grouped together into a column family which then are
stored together.
The members of a column family are generally all the same data type as each
other~\cite{bigtable}.
This is to allow optimised retrieval of commonly paired columns effectively.
To query data from a row of the database the row name and column name are
required to uniquely access the data~\cite{bigtable}.

% benefits
\paragraph{}
Columnar databases are similar to relational databases but has some key
characteristics that differentiate them.
These range from how the data is stored on disk, what parts of the
data is indexed, how foreign relations are handled and more~\cite{nosql_survey}.

\paragraph{}
The column-orientated method of storing data in columnar databases is a 
key characteristic.
To achieve this each column is serialized to disk
separately~\cite{bigtable,nosql_survey}.
This allows for faster reads of a single column, such as aggregates.
Figures~\ref{lst:row} and~\ref{lst:column} show the difference in serialisation
between a row-orientated database and a column-orientated database where each
line is a separate file.
A side effect of having similar data stored together is a greater potential to
compress the data more efficient~\cite{nosql_survey}.
This enables a columnar database to be sparse with its storage of data~\cite{bigtable}.

\paragraph{}
The common usage of indexes in databases are to store the indexed columns
separately for quick access~\cite{relational_db}.
However, in columnar databases all of the columns are already stored
separately and thus an index~\cite{nosql_survey}.

\paragraph{}
A characteristic of columnar databases is not supporting associations between
rows.
This implies that common features from relational models, such as a foreign relation, 
are not supported~\cite{relational_db,nosql_survey}.
Thus when making changes to a column only the effected column would be needed
to be checked for consistency errors.
This allows for many concurrent reads and writes across the database as each
column is independent in both consistency and in storage~\cite{nosql_survey}.

\begin{figure}
\begin{verbatim}
    SWEN304:Database Egineering:T2:2017
    COMP304:Programming languages:T2:2017
\end{verbatim}
\caption{Example of a table stored by rows}
\label{lst:row}
\end{figure}

\begin{figure}
\begin{verbatim}
    SWEN304:COMP304
    Database Egineering:Programming languages
    T2:T2
    2017:2017
\end{verbatim}
\caption{Example of a table stored by column}
\label{lst:column}
\end{figure}

\cite{usingcolumn}

\subsection{Use case}
% When are people using this
%  - Data warehousing
% Example of use case

The use cases for a columnar database focus on long term storage of large
volumes of data, or data warehousing.

\cite{nosql_performance}
\cite{bigtable}

% === graph ===

\section{Graph}
% How does it work
% Relate it back to BASE

\subsection{Use case}
% When are people using this
% Example of use case

\cite{nosql_performance}

\section{Conclusion}

\bibliographystyle{agsm}
\bibliography{essay}

\end{document}
