\chapter{Conclusions}\label{C:con}

\comment{
 Goal of chapter: 

  * reflect on the project, \\
  * how it was accomplished, \\
  * what it accomplished, \\
  * what could be done better next time, \\
  * what was learnt. \\
}

\section{Accomplishments}
\comment{talk about how the goal of the project was accomplished, loop invariants are generated for Whiley}

\section{Reflection}
\comment{How well did things go? Room for improvement? Is this appropriate?}

\section{Related Work}
\comment{Covers the literature review and compare current solution to similar projects}

\fixme{Should this be in the conclusion section rather than here?}

\subsection{Dafny}
\comment{
explain how dafny is an alternative to Whiley in the Spec Lang space
has some features that are missing in Whiley that would be interesting to use

* declaring variables as increasing or decreasing \\
* defining variables / fields as ghosts, to only be used in specifications
dafny - other formal language
}

An alternative to the Whiley language is the Dafny.
Dafny is a research language for a verifying compiler by Microsoft
\cite{dafny-lang}.
The language shares a majority of the same features as

\todo{dafny alternative}
\cite{dafny-started}
\cite{dafny-lang}
\cite{dafny-mech}

\subsection{Pattern-based loop invariant generation}

\cite{pattern-loop-inv}

\subsection{Methods to Generate Loop Invariants}
\comment{explain how these methods create loop invariants}

\subsubsection{Manual Generation}
\comment{Manual is always a thing }

\cite{broda-loop-tech}

\subsubsection{Backwards Propagation}

\cite{infer-postconditions}
\cite{infer-dynamic}

\subsubsection{Variable Aging}

\cite{infer-postconditions}
\cite{infer-dynamic}

\subsubsection{Coupling}

\cite{infer-postconditions}
\cite{infer-dynamic}

\subsubsection{Term dropping}

\cite{infer-postconditions}
\cite{infer-dynamic}

\cite{struct-induction}


\section{Future work}

This section outlines potential future work from the result of this project.
Each section gives a brief outline of an issue raised or faced during this
project and a possible project that could provide a solution to it.

\subsection{Detection of Duplicate Loop Invariant}
\comment{this could be in the form of lexical, AST, logical equivalence}

With the introduction of generated loop invariants the duplication of loop
invariants become an issue.
A future project could be to detect and inform the programmer of these
duplications.
This could be achieved by equating loop invariants with a range of methods.
The most simple method being lexical equivalence, comparing if code are same.
An increased complexity of attempting to detect equivalent syntax with the same
semantics, e.g. \code{i >= 0} is the same as \code{0 <= i}.
With the most complex being logical equivalence, e.g. \code{i > 0 || i == 0} is the same
as \code{i >= 0}.


\subsection{Expanding Loop Invariant Generators}
\comment{
	There is more loop patterns that could be used to generate loop invariants \\
	Not all possible cases are covered by the current implementations \\
	either find these new invariants by hand, or ML \\
}

Only some of the loop patterns in Whiley were identified and exploited for loop
invariants.
A future work could expand the number of loop invariant generators or reduce
the limitations in the current generators.
The current generators currently have some limitations could be lifted with
additional work, for example static evaluation of branches to reduce the
complexity of the code being generated on.
Since the identification of loop patterns is an intensive task an automated
approach could be identified, such as applying machine learning or other static
analysis techniques.

\subsection{Visitor Pattern for the Whiley Compiler}
\comment{
	Current implementations of Generators have cloned structures \\
	Code duplication could be reduced by using Visitor Pattern \\
	* decreases maintenance cost \\
	* makes adding new syntax / AST nodes easier \\
	* technical debt having so many duplicate AST descents \\
}

A technical issue of extending the Whiley compiler is the architecture forces
the programmer to support all statements and expressions.
This causes a large amount of duplication of code for each component of the
compiler to traverse the abstract syntax tree of any of Whiley or the internal
languages of WyIL and WyAL.
This accumulates technical debt for each component as they all need to be
updated to handle new syntax.
Currently the only method to detect if some syntax is not supported is via 
failing a runtime test that the syntax is handled.
A future work of implementing the visitor pattern for Whiley and the internal
languages.
This would improve the code quality by providing strict interfaces and
classes that handle the traversal of abstract syntax trees.
This removes the issue of each component having to re-implementing traversals
and the interfaces allow the user to implement methods to handle each type of
syntax either strictly for each syntax element (via Java interfaces) or
non-strictly (via extending Java classes).

\subsection{Ghost Variables in Whiley}
\comment{
	See Ada's `'Old`  syntax \\
	Declaration of `ghost` prefix to variable declaration so they are only usable \\
	in program verification \\
}

During the project the issue of lack of ghost variables in Whiley blocked some
invariants and limited others.
They were limited by the design constraint of not wanting to generate local
variables due to the runtime cost (see section~\ref{s:design-create-var} for
more detail ).
This cost can be avoided if Whiley had ghost variables, or syntax to refer to
the value of a variable prior to the loop without copying the value.
The future work would be to add syntax to the Whiley language to support this
feature and teach the specification pipeline how to handle the ghosted
variables.
The ghost variables do not only have to be limited to loops and could also be 
extended to include the values of variables before they enter functions or
cross other boundaries.
This has been achieved in other formal specification languages such as Ada and
Dafny.

\subsection{Generated Loop Invariants in WhileyWeb}
\comment{
	Update WhileyWeb to include generated loop invariants \\
	* show in the same manner as counter-examples \\
	* is the tool most likely used in future course work of the course \\
	* a pleasant UX in a web IDE \\
}

WhileyWeb is Whiley's web developer environment that is mostly used when
developing Whiley.
A future project could be to integrate the generated loop invariants with
the web interface such as the new counter-example feature has been added to
Whiley and WhileyWeb.
Generated loop invariants could be shown as warnings with code snippets of what
was generated and why they were generated.
The challenge of this project is to control the loop invariant
generators and display their results in a natural and user friendly way.
This would also provide an opportunity to do user testing on how generated
loop invariants affect student learning of loop invariants that could not be
completed with this project.