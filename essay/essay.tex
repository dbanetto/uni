\documentclass{CRPITStyle}
\usepackage[authoryear]{natbib}
\renewcommand{\cite}{\citep}
\pagestyle{empty}
\thispagestyle{empty}
\hyphenation{roddick}

\begin{document}

\title{When to use NoSQL}
\author{David Barnett}
\affiliation{School of Engineering and Computer Science \\
Victoria University of Wellington, \\
PO Box 600, Wellington, 6140 \\
Email:~{\tt barentdavi@myvuw.ac.nz}}

\maketitle

\begin{abstract}
    TODO Abstract
\end{abstract}

\vspace{.1in}

\noindent{\em Keywords:} NoSQL, Use cases, Document Store, Column Base, Graph database

\section{Introduction}
% Cover the aim of the essay

\paragraph{}
With growing use of NoSQL databases in production environments it has become more
important to understand when and why to use them over a traditional
relational database.
NoSQL can be broken down to many different types which differ on how
data is represented~\cite{type_nosql}.
For example the traditional relational databases are based upon relational
model and relational algebra~\cite{relational_db}.

\paragraph{}
This report will cover some common types of NoSQL databases.
These are: Document store; Column base; and, Graph databases.
For each of these types this report will give an overview on how each type
operates and a description of its use case with a comparison with a
traditional SQL database.

\cite{whats_new}
\cite{sql_nosql_gap}
\cite{scalable_sql}

\section{What is NoSQL}
% brief overview

\paragraph{}
NoSQL is a class of databases that are not based on
a relational data model~\cite{nosql_db}.
Instead of using relations the data is modeled using a large
variety of models are used, such as graphs, documents or objects.
These allow for application specific optimisations that
a relational database could not provide.
The need for these optimisations are motivated by the growing
volume of data used in large distributed systems~\cite{nosql_db}.


\paragraph{}
The CAP theorem states that no distributed system can be
simultaneously always consistent, available and
partitions tolerant but at most two of these properties~\cite{base,nosql_db,compare_nosql}.
This is due to the conflict between these properties, such as a
strictly consistent database handling an update would
need to lock the modified data as the update is being distributed
so all clients have the same consistent data.

\paragraph{}
In the case of databases they can be designed to provide a
range of guarantees and to how the data is stored and retrieved.
For relational databases they are designed to hold
the ACID properties~\cite{relational_db,base}.
Figure~\ref{l:acid} provides a brief outline of the ACID properties.
These properties ensure that the data committed will be stored in a 
consistent manner that allows some concurrency.
This is highly desired in applications that require guaranteed consistency
for critical data such as bank accounts.
In terms of the CAP theorem the consistency aspect is the most important
guarantee.

\begin{figure}
\begin{itemize}
    \item \textbf{A}tomic - every transaction will either
        succeed and be applied or fail and commit no modifications.
    \item \textbf{C}onsistent - the state of all relations are
        always in a consistent state.
    \item \textbf{I}solation - transactions are performed as if sequentially.
    \item \textbf{D}urability - after a successful transaction the results
        are persistent over crashes.
\end{itemize}
    \caption{Outline of the ACID properties~\cite{relational_db,base}}\label{l:acid}
\end{figure}
%
% give definition of a database? (managed store of data)
% relational is based on set theory and relational algebra

%% BASE
% What it is

\paragraph{}
An alternative to ACID is BASE where the objective is replaced from consistency
to availability.
This is desirable in large distributed systems that do not need to be
fully consistent but require to always be available.
For example an application will not mind that it has some stale or
inconsistent data since it has been built to handle it.
This is generally present in NoSQL databases when used in multiple
locations, such as a distributed document store~\cite{base}.
Figure~\ref{l:base} has a brief outline of these properties.

\begin{figure}
\begin{itemize}
    \item \textbf{B}asically \textbf{A}vailable - When a part of the system
        fails only some or none of the data maybe be unavailable rather than
        all of it.
    \item \textbf{S}oft state - The data present on a node may change over time
        without a direct update as eventual consistency is applied.
    \item \textbf{E}ventual consistency - The shared data on a node will become consistent with
        other nodes over time.
\end{itemize}
\caption{Overview of BASE properties~\cite{base}}\label{l:base}
\end{figure}

% How does it compare to ACID

% how it relates to NoSQL

% trade-off between consistency, availability and partition tolerant

% === Document Store ===

\section{Document Store}
% How does it work
%  - key to a structured document
%  - document can be inspected by DBMS
% Relate it back to BASE

\paragraph{}
Document store databases are designed to store their data in the form of
structured documents~\cite{base}.
There are a wide range of structured documents used with document store
databases, such as XML, JSON and more~\cite{base,compare_nosql}.
Two implementations of a document store database are: \textbf{MongoDB} which
structures its data as JSON~\cite{base}; and, \textbf{BaseX} which is based on XML
documents~\cite{basex}.
Though the format of the documents are well defined the 
way how data is laid out within this format is not.
This makes documents stores a semi-structured database.

\paragraph{}
The data model for a document store can be simpler relative a relational model.
A single document is an instance of an entity, such as someone's contact information.
Where in a relational model someone's contact information would be
normalized to be spread over many tables as there are many optional sections.
In this case the document representation is simpler as it has all of the
information in one place.
This lead to the pattern of storing all the data for a single entity into
one document rather than spread it over many relations that then need to
joined.

\paragraph{}
A benefit of a document store is being able to query the documents
by leveraging their structure.
This is exposed to the user through the database's API or a format specific
query language, such as XPath for XML~\cite{xpath}.
For example in MongoDB the call in figure~\ref{lst:mongo} would retrieve all
stored documents about books with the title \textit{Database}.
In this case MongoDB's API is designed to mimic the internal JSON structure 
of the stored documents.
Another example is BaseX with its ability to use XPath to query a document.
In figure~\ref{lst:basex} shows a simple XPath query that also retrieves
the documents that contain books with the title \textit{Database}.

\begin{figure}
\begin{verbatim}
books.find({ title: "Database" })
\end{verbatim}
\caption{Example query for MongoDB}
\label{lst:mongo}
\end{figure}

\begin{figure}
\begin{verbatim}
/book/tite[text() = 'Database']
\end{verbatim}
\caption{Example query for BaseX using XPath}
\label{lst:basex}
\end{figure}

\subsection{Use case}
% When are people using this
%  - JSON store
%  - XML store
% Example of use case
%  - Searching



\subsection{When to use it}
% Why are people choosing this
% Compare to relational counterpart

% === Column base ===

\section{Column base}
% How does it work
% Relate it back to BASE

\subsection{Use case}
% When are people using this
% Example of use case

\subsection{When to use it}
% Why are people choosing this
% Compare to relational counterpart

% === graph ===

\section{Graph}
% How does it work
% Relate it back to BASE

\subsection{Use case}
% When are people using this
% Example of use case

\subsection{When to use it}
% Why are people choosing this
% Compare to relational counterpart

\section{Conclusion}


\bibliographystyle{agsm}
\bibliography{essay}

\end{document}
