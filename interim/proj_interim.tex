\documentclass[11pt, a4paper, twoside, openright]{report}

\usepackage{float} % lets you have non-floating floats

\usepackage{listings}
\usepackage{color}
\usepackage{url} % for typesetting urls
\usepackage[parfill]{parskip}

%  We don't want figures to float so we define
%
\newfloat{fig}{thp}{lof}[chapter]
\floatname{fig}{Figure}

\definecolor{grey}{rgb}{0.95,0.95,0.95}

\lstset{%
    backgroundcolor=\color{grey},
    frame=single,
    numbers=left
}

%% These are standard LaTeX definitions for the document
%%
\title{Generating simple loop invariants for Whiley}
\author{David Barnett}

%% This file can be used for creating a wide range of reports
%%  across various Schools
%%
%% Set up some things, mostly for the front page, for your specific document
%
% Current options are:
% [ecs|msor|sms]          Which school you are in.
%                         (msor option retained for reproducing old data)
% [bschonscomp|mcompsci]  Which degree you are doing
%                          You can also specify any other degree by name
%                          (see below)
% [font|image]            Use a font or an image for the VUW logo
%                          The font option will only work on ECS systems
%
\usepackage[image,ecs]{vuwproject} 

\supervisors{Lindsay Groves}
\otherdegree{Bachelor of Engineering with Honours in Software Engineering}

% Comment this out if you want the date printed.
\date{}
\newcommand{\code}[1]{\texttt{#1}}

\begin{document}

% Make the page numbering roman, until after the contents, etc.
\frontmatter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{abstract}
    % TODO: abstract
\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\mainmatter{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{1. Introduction}
% This should briefly outline the project and if necessary 
% reevaluate the original plan in light of what has been learned in the interim.  In
% particular, any significant deviations in the problem being addressed, or the solution
% being developed should be clearly highlighted and justified. (1 pages)
%% TODO: Also have the proposal as an appendix

% outline 
Whiley is a programming language that can be used for formal software
verification. One aspect of formal software verification is providing loop
invariants.
The primary goal of this project is to relieve some proof obligations from a
Whiley programmer by automatically providing some simple loop invariants.
Instead the loop invariants are generated by the Whiley Compiler itself.
This project does not attempt to generate loop invariants generally, as it is
known to be uncomputable, but generates invariants for specific common cases.

% Why
The purpose of this project is to make Whiley more usable in practise.
Loop invariants are a common pain point for users of formally verified
languages. Simple loop invariants are repetitive and become a chore to
always provide them. With this project some of this pain is alleviated.

% Changes since proposal

% 'simple'
The definition of a simple loop invariants for this project is an invariant that is
obvious at inspection that an invariant both exists and holds.
An example would be that while iterating through an array the index
will not go out of bounds of the array, such as figure~\ref{lst:whiley-ex-1}.
The purpose of having a strict definition of an simple invariant is to prevent
possible confusion when what looks to be unproven code is verified and to point
the scope of the project away from being too general, such as supporting
a rare scenarios such as indexing an array with a polynomial equation.
This leaves the more interesting invariants for the user to define.

\begin{figure}[h]
\begin{lstlisting}
    function indexOf (int[] items, int item) -> (int r)
    ensures r == |items| || items[r] == item:

    int i = 0

    while i < |items|
      where i >= 0 && i <= |items|:

        if items[i] == item:
            break
        i = i + 1

    return i
\end{lstlisting}
\caption{Verified Whiley code to find index of an item in an array}
\label{lst:whiley-ex-1}
\end{figure}

% loop patterns
Since the proposal it has become clear that simple loop invariants are
akin to design patterns for loops.
From studying a known loop pattern properties can be derived from it.
Such as figure~\ref{lst:whiley-ex-1} that has a common loop pattern of
iterating an array via an index variable.
From this pattern you know that that during the loop that the index will be
within bounds of the array.
This can be exploited by statically detecting the loop patterns and informing
the Whiley Compiler of these properties.

\section*{2. Background}
% This should discuss any existing solutions to the given problem,
% and may reference academic papers,  books and other sources as appropriate.   Care
% should be taken to identify key differences between these solutions,  and that being
% developed in the project. (3-4 pages)

%% Formal Software Verification
% goals of class of languages (could be covered in Whiley)

%% Whiley
% whiley design paper
\cite{whiley-origin} \cite{whiley-design}
% dafny - other formal languages
\cite{dafny-started}

%% Invariants
% always holds

%% Loop invariants
% overview of loop invariants
% classification of loop invariants
% example

%% Methods to generate loop invariants
% generally generating loop invariants are impossible!
% infer dynamic
% finding invariants via static analysis

\section*{3. Work Done}
% This should discuss what progress has been made on designing, implementing
%  and evaluating the artifact. Care must be taken to ensure that any discussion
% of technical points are clearly explained, with diagrams being used where appropriate.
% In many cases, the evaluation proper will not yet have begun. However, it is important
% to demonstrate that sufficient thought has been given to the evaluation.
% (2 pages)

%% Implemented so far
% implemented algorithms for generating invariants
%  * entry value of a simple mutation and its sequence
%  * array length of a generated / copied array

% Found that this method is requires a code pattern to exploit
% a characteristic of it so it can then be able to generate it

%% Evaluation
% measurable deduction of proof obligations
% # of total loops effected

\section*{4. Future Plan}
% This should highlight the main components which remain to be done,
% and provide a proposed time-line in which this will happen. In putting together a time
% line, students must take into account upcoming examinations, coursework deadlines
% and other disruptions.
% (1 pages)

% identify common invariant/loop patterns to codify
% found a few 
%   * map pattern - loops through array applying function to each element
%   * for all - simple loop to see if all elements satisfies a condition
%   * for some - simple loop until an element satisfies a condition

\section*{5. Request for Feedback}
% This should  highlight  any  difficulties  currently  faced,  and
% make specific requests for guidance from the examination committee.  For example,
% a student  may  be  unsure  how  best  to  evaluate  their  artifact,  and  would  appreciate
% suggestions for alternative methods.
% (1 pages)

%% Help
% Suggested invariant patterns


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\backmatter{}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\bibliographystyle{ieeetr}
\bibliographystyle{acm}
\bibliography{report}
\end{document}

