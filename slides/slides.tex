\include{header}

\title{Generating Simple Loop Invariants in Whiley}
\author{David Barnett}
\date{Supervisor: Lindsay Groves}

\begin{document}
\frame{\titlepage}



\begin{frame}{Overview}

\begin{itemize}
\item Motivation
\item Background
\item Solution
\item Evaluation
\item Conclusion
\end{itemize}

\end{frame}



\begin{frame}{Motivation}

Goals of the project
\begin{itemize}
\item{To generate simple loop invariants}
\item{To investigate how generating loop invariants affect learning about loop
        invariants}
\end{itemize}

\end{frame}



\begin{frame}{Background}

\end{frame}



\begin{frame}{Solution}

Generates 4 loop invariants

\begin{itemize}
\item Starting bound
\item Equal array length
\item Upper bound
\item Array iterative assignment
\end{itemize}

\end{frame}



\begin{frame}[fragile]{Starting Bound}

\begin{columns}

\begin{column}{0.5\textwidth}
\begin{itemize}
\item Generally counting variables
\end{itemize}

\end{column}

\begin{column}{0.5\textwidth}
\begin{verbatim}
int i = 0
while C
    where i >= 0
    i = i + 1
\end{verbatim}

\end{column}

\end{columns}

\end{frame}



\begin{frame}[fragile]{Equal array length}

\begin{columns}

\begin{column}{0.5\textwidth}
\end{column}

\begin{column}{0.5\textwidth}
\begin{verbatim}
copy = items
// or
copy = [0; |items|]

while i <= |items|
    where |copy| == |items|:
    copy[i] = f(items[i])
    i = i + 1
\end{verbatim}
\end{column}
\end{columns}

\end{frame}



\begin{frame}[fragile]{Upper bound}

\begin{columns}

\begin{column}{0.5\textwidth}
\end{column}

\begin{column}{0.5\textwidth}
\begin{verbatim}
int i = 0
while i < C
    where i <= C:
    i = i + 1
\end{verbatim}
\end{column}

\end{columns}

\end{frame}



\begin{frame}[fragile]{Array iterative assignment}

\begin{columns}

\begin{column}{0.5\textwidth}
\end{column}

\begin{column}{0.5\textwidth}
\begin{verbatim}
int i = 0
while i <= |items|
    where all { k in 0..i |
        items[k] == f(k) }:
    items[i] = f(i)
    i = i + 1
\end{verbatim}
\end{column}

\end{columns}

\end{frame}

\begin{frame}{Evaluation}

\begin{block}{Goal}
Provide evidence that the generated invariants will reduce the
number of invariants needed to be provided in the source code.
\end{block}

\begin{block}{Data sets}

\begin{itemize}
\item Whiley Compiler test suite
\item SWEN224 assignments and labs
\end{itemize}

\end{block}

\end{frame}

\begin{frame}{Evaluation}

\begin{block}{Data sets}

\begin{itemize}
\item Whiley Compiler test suite
\item SWEN224 assignments and labs
\end{itemize}

\end{block}

\end{frame}



\begin{frame}{Evaluation tool}

\begin{block}{Assumptions}

\begin{itemize}
\item Code to be evaluated can be compiled and verified normally.
\item Loop invariant generator can be toggled.
\end{itemize}

\end{block}


\begin{block}{Steps}
\begin{itemize}
\item Breakdown
\item Minimize
\item Reporting
\end{itemize}
\end{block}

\end{frame}



\begin{frame}[fragile]{Evaluation - Breakdown}

Normalizes the loop invariants in source code

\begin{columns}
\begin{column}{0.4\textwidth}
\begin{block}{Before}
\begin{verbatim}
where A && B && C
\end{verbatim}
\end{block}
\end{column}
\begin{column}{0.1\textwidth}
$\rightarrow$
\end{column}
\begin{column}{0.4\textwidth}
\begin{block}{After}
\begin{verbatim}
where A
where B
where C
\end{verbatim}
\end{block}
\end{column}
\end{columns}

\end{frame}



\begin{frame}[fragile]{Evaluation - Minimize}

Finds the smallest combonation of invariants to verify
the program.

\begin{columns}
\begin{column}{0.4\textwidth}
\begin{block}{Invariants}
\begin{verbatim}
where A
where B
where C
\end{verbatim}
\end{block}
\end{column}
\begin{column}{0.4\textwidth}
\begin{align*}
    &\{ A \} \\
    &\{ B \} \\
    &\{ C \} \\
    &\{ A, B \} \\
    &... \\
    &\{ A, B, C \} \\
\end{align*}
\end{column}
\end{columns}

\end{frame}

\begin{frame}[fragile]{Evaluation - Report}

Counts and classifies the invariants present.

\begin{columns}
\begin{column}{0.4\textwidth}
\begin{verbatim}
  int i = 0
  while i < |items|
      where g(i):
      f(items[i])
      i = i + 1
\end{verbatim}
\end{column}

\begin{column}{0.1\textwidth}
    \[\rightarrow\]
\end{column}

\begin{column}{0.5\textwidth}
\begin{longtable}[]{@{}llll@{}}
\midrule
\endhead
Total Invariants & 3\tabularnewline
Source Invariants & 1\tabularnewline
Generated Invariants & 2\tabularnewline
Starting bound & 1\tabularnewline
Arrays Equal & 0\tabularnewline
Upper Bound & 1\tabularnewline
Iterative Assign & 0\tabularnewline
\bottomrule
\end{longtable}


\end{column}
\end{columns}

\end{frame}



\begin{frame}{Results}

Evaluation of the Whiley Compiler test suite

\begin{longtable}[]{@{}llll@{}}
\toprule
Type & Control & Minimized & Generated Invariants\tabularnewline
\midrule
\endhead
Total Invariants & 160 & 135 & 176\tabularnewline
Source Invariants & 160 & 135 & 41\tabularnewline
Generated Invariants & & & 135\tabularnewline
Starting bound & & & 94\tabularnewline
Arrays Equal & & & 16\tabularnewline
Upper Bound & & & 17\tabularnewline
Iterative Assign & & & 8\tabularnewline
\bottomrule
\end{longtable}

\end{frame}



\begin{frame}{Results}

\begin{itemize}
\item 70\% reduction of invariants required in source code, compared to
    minimized
\item Total invariants increased
\item 
\end{itemize}

\end{frame}



\begin{frame}{Conclusion}

\begin{itemize}
\item Can generate simple loop invariants
\item Reduced number of invariants programmer provides
\end{itemize}

\end{frame}



\begin{frame}

\begin{center}
    \Huge{Questions}
\end{center}

\end{frame}

\begin{frame}[fragile]{Additional examples}

\begin{verbatim}
function sum(int[] items) -> (int r)
requires all { i in 0..|items| | items[i] >= 0 }:
  int i = 0
  int sum = 0
  //
  while i < |items|
    where sum >= 0
    where i >= 0: // starting bound
    //
    sum = sum + items[i]
    i = i + 1
  //
  return sum
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Additional examples}

\begin{verbatim}
function instances(int[] items, int x) -> (int c):
  int i = 0
  int c = 0
  while i < |items|
    where i >= 0
    where c >= 0:
    //
    if items[i] == x:
      c = c + 1
    //
    i = i + 1
  //
  return c
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Additional examples}

\begin{verbatim}
function add(int[] items, int delta) -> (int[] c):
  int i = 0
  int mod = items
  while i < |items|
    where i >= 0
    where |mod| == |items|
    where all { j in 0..i | mod[j] = items[j] + delta }:
    //
    mod[i] = items[j] + delta
    i = i + 1
  //
  return mod
\end{verbatim}

\end{frame}

\begin{frame}[fragile]{Additional examples}

\begin{verbatim}
function min(int[] items) -> (int r)
requires |items| > 0
ensures all { i in 0..|items| | r <= items[i] }
ensures some { i in 0..|items| | r == items[i] }:
  int i = 1
  int m = items[0]
  while i < |items|
  where i >= 1 // starting bound
  where i <= |items| // upper bound
  where all { j in 0..i | m <= items[j] }
  where some { j in 0..i | m == items[j] }:
    if m > items[i]:
      m = items[i]
    i = i + 1
  return m
\end{verbatim}


\end{frame}

\end{document}
